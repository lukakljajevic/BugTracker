<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item" aria-current="page"><a [routerLink]="['/projects']">Projects</a></li>
    <li class="breadcrumb-item active" aria-current="page">{{project.name}}</li>
  </ol>
</nav>
<div class="row">
  <div class="col-md-10">
    <h3>{{project.name}} board</h3>
  </div>
  <div class="col-md-2">
    <div>
      <!-- <button class="btn"><fa-icon [icon]="['far', 'star']" size="lg"></fa-icon></button> -->
      <div class="btn-group" dropdown placement="bottom right" *ngIf="currentUserRole === 'manager'">
        <button id="project-options-button" dropdownToggle type="button" class="btn" aria-controls="dropdown-animated"><fa-icon [icon]="['fas', 'cog']" size="lg"></fa-icon></button>
        <ul id="dropdown-animated" *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="project-options-button">
          <li role="menuitem"><a class="dropdown-item" (click)="dragModeEnabled = !dragModeEnabled">{{dragModeEnabled ? 'Disable' : 'Enable'}} drag mode</a></li>
          <li role="menuitem"><a class="dropdown-item" (click)="openModal(deleteModal)">Delete project</a></li>
        </ul>
      </div>

    </div>
  </div>
</div>
<div class="row" id="filter">
  <div class="col-lg-2">
    <div class="inner-addon right-addon" tabindex="1"> 
      <fa-icon [icon]="['fas', 'search']" class="icon"></fa-icon>
      <input 
        [(ngModel)]="searchTerm"
        (input)="search($event)"
        type="text"
        name="searchTerm"
        class="form-control" 
        placeholder="Search" />
    </div>
  </div>
  <div class="col-lg-2 max-width-150">
    <select 
      [(value)]="issueType"
      (input)="search($event)" 
      name="issueType"
      class="form-control">
      <option value="" selected disabled hidden>Issue type</option>
      <option value="task">Task</option>
      <option value="bug">Bug</option>
    </select>
  </div>
  <div class="col-lg-2 max-width-150">
    <select 
      [(value)]="label"
      (input)="search($event)"
      name="label"
      class="form-control">
      <option value="" selected disabled hidden>Label</option>
      <option *ngFor="let l of labels" [value]="l.name">{{l.name}}</option>
    </select>
  </div>
  <div class="col-lg-1">
    <button 
      class="btn btn-outline-warning" 
      (click)="resetFilters()"
      *ngIf="viewResetFilter()">Reset</button>
  </div>
</div>
<div class="row" id="invite" *ngIf="currentUserRole === 'manager'">
  <div class="col-md-12">
    <button
      class="btn btn-primary"
      *ngFor="let user of project.projectUsers"
      tooltip="{{user.userFullName}}">
        {{getInitials(user.userFullName)}}
    </button>
    <button 
      class="btn btn-outline-primary" 
      (click)="openModal(inviteModal)"
      tooltip="Add people">
        <fa-icon [icon]="['fas', 'users']" class="icon"></fa-icon>
    </button>
  </div>
</div>
<app-phase-list 
  [project]="project"
  [projectId]="project.id" 
  [phases]="previewPhases"
  [dragModeEnabled]="dragModeEnabled"
  [currentUserRole]="currentUserRole"></app-phase-list>

<div class="modal fade" 
     bsModal 
     #inviteModal="bs-modal" 
     (onHidden)="userFullNameSelected = ''">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title pull-left">Create a new phase</h5>
        <button type="button" class="close pull-right" aria-label="Close" (click)="closeModal(inviteModal)">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-12">
            <label for="name">User full name</label>
            <input [(ngModel)]="userFullNameSelected"
                   [typeahead]="users$"
                   [typeaheadAsync]="true"
                   [typeaheadItemTemplate]="itemTemplate"
                   [isAnimated]="true"
                   (typeaheadOnSelect)="typeaheadOnSelect($event)"
                   typeaheadOptionField="fullName"
                   typeaheadWaitMs="1000"
                   type="text" 
                   placeholder="Please enter user's full name" 
                   class="form-control">
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <select [(ngModel)]="selectedUserRole" class="form-control">
              <option value="user">User</option>
              <option value="manager">Manager</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <button class="btn btn-outline-success btn-block" 
                    (click)="inviteUser()" 
                    [disabled]="selectedUser === null">Invite</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #itemTemplate let-model="item" let-index="index">
  {{model.fullName}} <i>({{model.userName}})</i>
</ng-template>

<div class="modal fade" 
     bsModal 
     #deleteModal="bs-modal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title pull-left">Delete project</h5>
        <button type="button" class="close pull-right" aria-label="Close" (click)="closeModal(deleteModal)">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body text-center">
        <p>Are you sure you want to delete this project?</p>
        <button type="button" class="btn btn-outline-danger" (click)="deleteProject()">Yes</button>
        <button type="button" class="btn btn-default" (click)="closeModal(deleteModal)">No</button>
      </div>
    </div>
  </div>   
</div>